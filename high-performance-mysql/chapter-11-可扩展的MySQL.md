### 可扩展的 MySQL

#### 什么是可扩展性
可扩展性表明当需要增加资源以执行更多工作时系统能够获得划算的等同提升 (equal bang for the buck) 的能力; 缺乏扩展能力的系统在达到收益递减的转折点后, 将无法进一步增长

##### 正式的扩展性定义
可扩展性是当增加资源以处理负载和增加容量时能够获得的投资产出率 (ROI)

#### 扩展 MySQL
- 向上扩展 (垂直扩展)
- 向外扩展 (水平扩展)
- 向内扩展

##### 规划可扩展性
TODO

##### 为扩展赢得时间
- 优化性能
- 购买性能更好的硬件

##### 向上扩展
向上扩展也意味着购买更多性能更好的硬件; 这种策略使得维护和开发容易, 复杂性较低, 但向上扩展的天花板较低

#### 向外扩展
向外扩展的策略可以划分为三个部分: 复制, 拆分, 数据分片  
最简单的也最常见的向外扩展的方法是通过复制将数据分发到多个服务器上, 然后将备库用于读查询; 这种技术对于以读为主的应用应该有效, 但其他场景可能并不适用  
另外一个比较常见的向外扩展方法是将工作负载分布到多个 "节点", 拆分方法通常有以下几类
###### 按功能拆分
按功能拆分, 或者说按职责拆分, 意味着不同的节点执行不同的任务
###### 数据分片
在目前用于扩展大型 MySQL 应用的方案中, 数据分片是最通用且最成功的方法, 它把数据分割成一小片, 或者说一块, 然后存储到不同的节点中
###### 选择分区键
数据分片最大额挑战是查找和获取数据, 如何查找数据取决于如何进行分片; 那些最重要的并且频繁查询的数据减少分片, 这其中最重要的是如何为数据选择一个或多个分区键; 分区键决定了每一行分配到哪一个分片中, 如果知道了一个对象的分区键, 就可以知道写数据时应该在哪里存储, 读数据时应该在哪里获取
###### 多个分区键
复杂的数据模型会使分片更加困难, 许多应用拥有多个分区键, 特别是存在两个多多个 "维度" 的时候
###### 跨分片查询
TODO
###### 分配数据, 分片, 节点
TODO
###### 在节点上部署分片
TODO
###### 固定分配
TODO
###### 动态分配
TODO
###### 混合动态分配和固定分配
TODO
###### 显式分配
TODO
###### 重新均衡分片数据
TODO
###### 生成全局唯一 ID
当希望把一个现有系统转换为分片数据存储时, 经常会需要在多台机器上生成全局唯一 ID, 单一数据存储时通常可以使用 AUTO_INCREMENT 列来获取唯一 ID, 但这在涉及多台服务器时就不奏效了; 以下几种方法而可以解决这个问题
- 使用 auto_increment_increment 和 auto_increment_offset
这两个服务器变量可以让 MySQL 以期望的值和偏移量来增加 AUTO_INCREMENT 列的值
- 全局节点中创建表
在一个全局数据库节点中创建一个包含 AUTO_INCREMENT 列的表, 应用可以用过这个表来生成唯一数字
- 使用 memcached
在 memcached 的 API 中有一个 incr() 函数, 可以自动增长一个数字并返回结果; 也可以使用 Redis
- 批量分配数字
应用可以从一个全局节点中请求一批数字, 用完后再申请
- 使用复合值
可以使用一个复合值来做唯一 ID
- 使用 GUID
可以使用 UUID() 函数来生成全局唯一值

###### 分片工具
TODO

##### 通过多实例扩展
TODO
##### 通过集群扩展
TODO

##### 向内扩展
处理不断增长的数据和负载最简单的办法是对不再需要的数据进行归档和清理; 在设计归档和清理策略时需要考虑以下几点
- 对应用的影响
- 要归档的行
- 维护数据一致性
- 避免数据丢失
- 解除归档
###### 保持活跃数据独立
即使并不真的把老数据转移到其他服务器, 许多应用也能受益于活跃数据和非活跃数据的隔离
- 将表划分为几个部分
- MySQL 分区
- 基于时间的数据分区

#### 负载均衡
负载均衡的基本思路很简单, 在一个服务器集群中尽可能的平均负载量, 通常的做法是在服务器前端设置一个负载均衡器
- 可扩展性
- 高效性
- 可用性
- 透明性
- 一致性

##### 直接连接
TODO
##### 引入中间件
TODO
##### 一主多备间的负载均衡
TODO

#### 总结
TODO
