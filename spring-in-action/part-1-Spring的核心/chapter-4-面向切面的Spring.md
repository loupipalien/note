### 面向切面的 Spring
在软件开发中, 散布于应用中多处的功能被称为横切关注点 (cross-cutting concern); 通常来讲, 这些横切关注点从概念上是与应用的业务逻辑相分离的 (但是往往会直接嵌入到应用的业务逻辑中), 把这些横切关注点与业务逻辑相分离正是面向切面编程 (AOP) 所要解决的问题

#### 什么是面向切面编程
在应用中, 每个模块的核心功能都是为特定业务领域提供服务, 但是这些模块都需要类似的辅助功能, 例如安全和事务管理  
如果要重用通用功能的话, 最常见的面向对象技术是继承和委托; 但是如果在整个应用中都是用相同的基类, 继承往往会导致一个脆弱的对象体系, 而使用委托可能需要对委托对象进行复杂的调用  
切面提供了取代继承和委托的另一种可选方案, 而且在很多场景下更加清晰简洁; 在使用面向切面编程时, 我们仍在一个地方定义通用功能, 但是可以通过声明的方式定义这个功能要以何种方式在何处应用, 而无需修改受影响的类; 横切关注点可以被模块化为特殊的类, 这些类被称为切面; 这样做的有两个好处
- 每个关注点都集中在一个地方, 而不是分散在多出代码中
- 服务化模块更加简洁, 因为它们只包含主要关注点 (或核心功能) 的代码, 而次要关注点的代码被转移到切面中了

##### 定义 AOP 术语
###### 通知 (Advice)
在 AOP 术语中, 切面的工作被称为通知; 通知定义了切面要完成的工作, 还定义了何时执行这个工作, 它应该应用在某个方法被调用之前? 之后? 之前和之后都调用? 还是只在方法抛出异常时调用? Spring 切面可以应用 5 种通知
- 前置通知 (Before): 在目标方法被调用之前调用此通知功能
- 后置通知 (After): 在目标方法完成之后调用通知, 此时不会关系方法的输出是什么
- 返回通知 (After-returning): 在目标方法成功执行之后调用通知
- 异常通知 (After-throwing): 在目标方法抛出异常后调用通知
- 环绕通知 (Around): 通知包裹了被通知的方法, 在被通知的方法调用之前和调用之后执行自定义行为
###### 连接点 (Join point)
应用有数以千计的实际应用通知, 这些时机被称为连接点, 连接点是在应用执行过程中能够插入切面的一个点, 这个点可以是调用方法时, 抛出异常时等等; 切面代码可以利用这些点插入到应用的正常流程中, 并添加新的行为
###### 切点 (Pointcut)
如果说通知定义了切面的 "What" 和 "When" 的话, 那么切点就定义了 "何处"; 切点的定义会匹配通知所要织入的一个或多个连接点; 通常使用明确的类和方法名称, 或者是利用正则表达式定义所匹配的类和方法名称来指定这些切点
###### 切面 (Aspect)
切面是通知和切点的结合, 通知和切点共同定义了切面的全部内容: 它是什么, 在何时和何处完成其功能
###### 织入 (Weaving)
织入是把切面应用到目标对象闭关创建新的代理对象的过程, 切面在指定的连接点被织入到目标对象中; 在目标对象的生命周期里有多个点可以进行织入
- 编译期
切面在目标类编译期就被织入, 这种方式需要特殊的编译器; AspectJ 的织入编译器就是以这种方式织入切面的
- 类加载期
切面在目标类加载到 JVM 时被织入, 这种方式需要特殊的类加载器 (Classloader), 它可以在目标类被引入应用之前增强目标类的字节码; AspectJ 5 的加载织入 (load-time weaving, LTW) 就支持这种方式织入切面
- 运行期
切面在应用运行的某个时刻被织入, 一般情况下在织入切面时, AOP 容器会为目标对象动态创建一个代理对象, Spring AOP 就是以这种方式织入切面的
###### 引入 (Introduction)
引入允许向现有类添加新方法或属性

##### Spring 对 AOP 的支持
并不是所有的 AOP 框架都是相同的, 它们在连接点模型上可能有强弱之分, 有些允许在字段修饰符级别应用通知, 而另一些只支持与方法调用相关的连接点; 它们织入切面的方式和时机也不同; 但无论如何, 创建切点来定义切面所织入的连接点是 AOP 框架的基本功能  
Spring 和 AspectJ 项目之间有大量的协作, 而且 Spring 对 AOP 的支持在很多方面借鉴了 AspectJ 项目; Spring 提供四种类型的 AOP 支持
- 基于代理的经典 Spring AOP
- 纯 POJO 切面
- `@AspectJ` 注解驱动的切面
- 注入式 AspectJ 切面 (适用于 Spring 的各个版本)

前三种都是 Spring AOP 实现的变体, Spring AOP 构建在动态代理基础之上, 因此 Spring 对 AOP 的支持局限于方法拦截
- Spring 通知是 Java 编写的
- Spring 在运行时通知对象
- Spring 只支持方法级别的连接点


#### 通过切点来选择连接点
TODO
