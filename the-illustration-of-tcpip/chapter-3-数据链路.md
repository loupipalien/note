### 数据链路
#### 数据链路的作用
数据链路, 指 OSI 参考模型中的数据链路层, 有时也指以太网, 无线局域网等通信手段  
数据链路层的协议定义了通过通信媒介互连的设备之间传输的规范, 通信媒介包括双绞线, 同轴电缆, 光纤, 电波以及红外线等介质, 此外各个设备之间有时也会通过交换机, 网桥, 中继器等中转数据  
在以太网与 FDDI (Fiber Distributed Data Interface, 光纤分布式数据接口) 的规范中, 不仅包含 OSI 参考模型的第 2 层数据链路层, 也规定了第 1 层物理层的规范, 而在 ATM (Asynchronous Transfer Mode, 异步传输方式) 的规范中, 还包括了第 3 层网络层的一部分功能

#### 数据链路相关技术
##### MAC 地址
MAC 地址用于识别数据链路中互连的节点, 以太网或 FDDI 中, 根据 IEEE802.3 的规范使用 MAC 地址, 其他无线 LAN, 蓝牙等设备中也是相同规格的 MAC 地址; MAC 地址长 48 地址, 在使用网卡 (NIC) 的情况下, MAC 地址一般会被烧入到 ROM 中  
```
 1 2 3          24 25            48     
-----------------------------------
| | | ~厂商识别码~ | ~厂商内识别码~ |
-----------------------------------
第 1 位: 单播地址 (0) / 多播地址 (1)
第 2 位: 全局地址 (0) / 本地地址 (1)
第 3 ~ 24 位: 由  IEEE 管理并保证各厂家之间不重复
第 25 ~ 48 位: 由厂商管理并保证产品之间不重复
```
IEEE802.3 制定 MAC 地址规范时没有限定数据链路的类型, 即不论哪种数据链路的网络 (以太网, FDDI, ATM, 无线 LAN, 蓝牙等), 都不会有相同的 MAC 地址出现

##### 共享介质型网络
从通信介质 (通信, 介质) 的使用方法上看, 网络可分为共享介质型和非共享介质型  
共享介质型网络指由多个设备共享一个通信介质的一种网络, 最早的以太网和 FDDI 就是介质共享型类型; 在这种方式下, 设备之间使用同一个载波信道进行发送和接收; 基本上采用半双工通信方式, 并有必要对介质进行访问控制  
共享介质型网络中有两种介质访问控制方式: 一种是争用方式, 另一种是令牌传递方式
- 争用方式
争用方式 (Connection) 是争夺获取数据传输的权力, 也叫 CSMA (载波监听多路访问); 这种方法通常令网络中各个站采用先到先得的方式占用信道发送数据, 如果多个站同时发送帧, 则会发送冲突现象, 也因此会导致网络拥堵与性能下降; 在一部分以太网中, 采用改良 CSMA 的另一个方式 --- CSMA/CD 方式; CSMA/CD 要求每个站提前检查冲突, 一旦发送冲突, 则尽早释放信道
- 令牌传递方式
令牌传递方式是沿着令牌环发送一种叫做 "令牌" 的特殊报文, 是控制传输的一种方式, 只有获得令牌的站才能发送数据; 这种方式有两个特点: 一是不会冲突, 二是每个站都有通过平等循环获得令牌的机会, 因此即使网络拥堵也不会导致性能下降; 当然在这种方式, 一个站没有收到令牌前不能发送数据, 因此在网络不太拥堵的情况下数据链路利用率也不能达到 100%
##### 非共享介质网络
非共享介质网络是指不共享介质, 是对介质采取专用的一种传输控制方式, 在这种方式下, 网络中的每个站直连交换机, 由交换机负责转发数据帧, 在此方式下发送端和接收端并不共享通信介质, 因此采用全双工通信方式
- 半双工和全双工
半双工是指只发送或只接收的通信方式, 全双工则允许在同一时间内既可以发送数据也可以接收数据

##### 根据 MAC 地址转发
交换机集线器是一种将非共享介质型网络中所使用的交换机用在以太网中的技术, 也叫以太网交换机; 以太网交换机就是持有多个端口的网桥, 它们根据数据链路层中每个帧的目标 MAC 地址, 决定从哪个网络接口发送数据; 这是所参考的, 用以记录发送接口的表叫转发表 (Forwarding Table)  
由于 MAC 地址没有层次性, 转发表中的入口个数与整个数据链路中所有网络设备的数量有关; 当设备数量增加时, 转发表也会随之变大, 检索转发表所用的时间也就越来越长

##### 环路检测技术
为了解决网络中的环路问题, 有生成树和源路由两种方式
- 生成树方式
该方法由 IEEE802.1D 定义, 每个网桥必须在每 1 ~ 10 秒内相互交换 BPDU (Bridge Protocol Data Unit), 从而判断哪些端口使用哪些端口不使用, 以便消除环路; 一旦发生故障, 则自动切换线路利用哪些没有被使用的端口继续进行传输; IEEE802.1D 存在一个弊端, 即发生故障时网络切换耗时较长, IEEE802.1W 中定义了一个叫 RSTP (Rapid Spanning Tree Protocol) 的方法, 可以将耗时缩短到几秒内
- 源路由法
该方式可以判断发送数据的源地址是通过哪个网桥实现传输的, 并将帧写入 RIF (Routing Information Field), 网桥则根据这个 RIF 信息发送帧给目标地址, 因此网桥中出现了环路, 数据帧也不会被反复转发, 这种机制发送端本身必须具备路由的功能

##### LAN
交换机按照其端口区分了多个网段, 从而区分了广播数据传播的范围, 减少了网络负载并提高了网络的安全性; 然而异构的两个网段之间, 就需要具有路由功能的交换机; 这种对 VLAN 进行扩展, 由定义了 IEEE802.1Q (也叫 TAG VLAN)的标准, 改标准允许包含跨越异构交换机的网段; TAG VLAN 中对每个网段都用一个 VLAN ID 的标签进行唯一标识

#### 以太网
在众多数据链路中最为著名, 使用最广泛的莫过于以太网 (Ethernet), 它规范简单, 易于 NIC (网卡) 及驱动程序实现

##### 以太网连接形式
初期一般采用多台终端使用同一根同轴电缆的共享介质型, 随着发展一本采用终端与交换机之间独占电缆的方式实现以太网通信

##### 以太网的分类
以太网因通信电缆的不同及通信速度的差异, 衍生出了众多不同的以太网类型

##### 以太网的历史
TODO

#### 以太网帧的格式
以太网帧前端有一个叫前导码 (Preamble) 的部分, 由 0, 1 数字交替组合而成, 表示一个以太网帧的开始, 也是对端网卡能够确保与其同步的标志, 前导码末尾是一个叫做 SFD (Start Frame Delimiter) 的域, 其值为 11, 在这个域之后是以太网帧的本体; 前导码和 SFD 合起来占 8 个字节
```
                                前导码 (8 个 8 位字节)
-----------------------------------------------------------------------------------------
|10101010|10101010|10101010|10101010|10101010|10101010|10101010|10101011|从此往后是帧的本体
-----------------------------------------------------------------------------------------
以太网中将最后 2 比特称为 SFD, 而 IEEE802.3 中将最后 8 比特称为 SFD
```
以太网帧本体的前端是以太网的首部, 它总共占 14 个字节, 分别是 6 个字节的目标 MAC 地址, 6 个字节的 源 MAC 地址以及 2 个字节的上层协议类型
````
以太网帧体格式
---------------------------------------------------------------------------------------------
|目标 MAC 地址 (6 字节)|源 MAC 地址 (6 字节)|类型 (2 字节) |数据 (46 ~ 1500 字节)|FCS (4 字节)|
---------------------------------------------------------------------------------------------
IEEE802.3 以太网帧提格式
----------------------------------------------------------------------------------------------------------------------
|目标 MAC 地址 (6 字节)|源 MAC 地址 (6 字节)|帧长度 (2 字节)|LLC (3 字节)|SNAP (5 字节)|数据 (38 ~ 1492 字节)|FCS (4 字节)|
----------------------------------------------------------------------------------------------------------------------
````

#### 无线通信
##### 无线通信的种类
无线通信依据通信距离可分为以下类型

| 分类 | 通信距离 | 标准化组织 | 相关其他组织及技术 |
| :--- | :--- | :--- | :--- |
| 短距离无线 | 数米 | 个别组织 | RF-ID |
| 无线 PAN | 10 米左右 | IEEE802.15 | 蓝牙 |
| 无线 LAN | 100 米左右 | IEEE802.11 | Wi-Fi |
| 无线 MAN | 数千米 ~ 100 千米 | IEEE802.16, IEEE802.20 | WiMAX |
| 无线 RAN | 200 千米 ~ 700 千米 | IEEE802.22 | - |
| 无线 WAN | - | GSM, CDMA2000, W-CDMA | 3G, LTE, 4G, 下一代移动通信网络 |

无线 WAN 的最典型代表就是手机通信, 手机通过基站能够实现长距离通信

##### IEEE802.11
IEEE802.11 定义了无线 LAN 协议中物理层与数据链路层的一部分 (MAC 层); IEEE802.11 这个编号有时指众多标准的统称, 有时也指无线 LAN 的一种通信方式  
作为一种通信方式, IEEE802.11 在物理层上使用电磁波或红外线, 通信速度为 1Mbps 或 2Mbps, 然而这些通信速度在后面指定的 IEEE802.11a/b/g/n 等标准中被打破

##### IEEE802.11b 和 IEEE802.11g
IEEE802.11b 和 IEEE802.11g 是 2.4 GHz 频段中的无线局域网标准, 它们的最大速度分别可达到 11Mbps 和 54 Mbps, 通信距离可达到 30 -50 米
##### IEEE802.11a
在物理层利用 5GHz 频段, 最大传输速度可达 54Mbps 的一种无线通信标准, 虽然与 IEEE802.11b/g 存在一定的兼容性问题, 但业界也有支持这两种标准的产品
##### IEEE802.11n
IEEE802.11n 是在 IEEE802.11g 和 IEEE802.11a 的基础之上, 采用同步多条天线的 MIMO 技术, 实现高速无线通信的一种标准, 在物理层使用 2.4GHz 或 5GHz 频段, 其最大速度可达 150Mbps

##### 使用 无线 LAN 的注意事项
在无线 LAN 的标准中, 为防止盗听或篡改, 已定义可以对传输数据进行加密; 无线 LAN 可以无需拍照使用特定频段, 因此可能会收到其他通信设备的干扰

##### 蓝牙
与 IEEE802.11b/g 类似, 是使用 2.4GHz 频率无线电波的一种标准, 数据传输速率在 V2 中能达到 3Mbps (实际最大吞吐量为 2.1Mbps), 通信距离根据无线电波的信号强弱, 有 1m, 10m, 100m 三种类型, 通信终端最多允许 8 台设备

##### WiMAX
WiMAX (Worldwide Interoperability for Microware Access) 是使用微波在企业或家庭实现无线通信的一种方式, 如 DSL 或 FTTH 一样是实现无线网络关键步骤的一种方式

##### ZigBee
ZigBee 主要应用于家电的远程控制, 是一种短距离, 低功耗的无线通信技术, 最多允许 65536 个终端之间互连通信

#### PPP
##### PPP 定义
PPP (Point-to-Point Protocol) 是指点对点, 即 1 对 1 连接计算机的协议, PPP 相当于位于 OSI 参考模型第 2 层的数据链路层  
PPP 不像以太网和 FDDI, 后两者不仅与 OSI 参考模型的数据链路层有关, 还与第 1 层的物理层有关, 具体来讲, 以太网使用同轴电缆或双绞线电缆, 它可以决定其中 0, 1该被解释为何种电子信号, 与之相比 PPP 属于纯粹的数据链路层, 与物理层没有任何关系, 即仅有 PPP 无法实现通信, 还需要有物理层的支持  
PPP 可以使用电话线或 ISDN, 专线, ATM 线路; 此外 PPPoE 是在以太网的数据中加入 PPP 帧进行传输的一种方式

##### LCP 与 NCP
在开始进行数据传输前, 要先建立一个 PPP 级的连接, 当这个连接建立以后就可以进行身份认证, 压缩, 加密  
在 PPP 的主要功能中包括两个协议: 一个是不依赖上层的 LCP 协议 (Link Control Protocol), 另一个是依赖上层的 NCP 协议 (Network Control Protocol), 如果上层为 IP, 此时 NCP 也叫做 IPCP (IP Control Protocol)  
LCP 主要负责建立和断开连接, 设置最大接收单元 (MRU, Maximum Receive Unit), 设置验证协议 (PAP (两次握手明文传输) 或 CHAP (一次性密码)) 以及设置是否进行通信质量的监控; IPCP 则负责 IP 地址设置以及是否进行 TCP/IP 首部压缩等设置

##### PPP 的帧格式
TODO

##### PPPoE
TODO

#### 其他数据链路
在此之前已经介绍过了以太网, 无线通信, PPP 等数据链路, 除此之外还有很多其他类型的数据链路

##### ATM
ATM (Asynchronous Transfer Mode) 是以一个叫做信元 (5 字节首部加 48 字节数据) 的单位进行传输的数据链路, 由于其线路占用时间短和能够高效处理传输大容量数据等特点主要用于光与网络的连接
- ATM 的特点
ATM 是面向连接的一种数据链路, 因此在进行通信传输之前一定要设置通信线路, 这一点与传统电话相似, 但与传统电话不同的是, 它允许同时多个对端建立通信连接
- ATM 与上层协议
在以太网中一个帧最大可传输 1500 个字节, FDDI 可以最大传输 4352 个字节; 而 ATM 的一个信元却只能发送固定的 48 字节数据, 这 48 字节的数据部分中若包含 IP 首部和 TCP 首部, 则基本无法存放上层的数据; 为此一般不会单独使用 ATM, 而是使用上层的 AAL (ATM Adapter Layer), 在上层为 IP 的情况下, 则叫做 AAL5

##### POS
TODO
##### FDDI
TODO
##### Token Ring
TODO
##### 100VG-AnyLAN
TODO
##### 光纤通信
TODO
##### HIPPI
TODO
##### IEEE1394
TODO
##### HDMI
TODO
##### iSCSI
TODO
##### InfiniBand
TODO
##### DOCSIS
TODO
##### 高速 PLC
TODO

| 数据链路名称 | 介质传输速率 | 用途 |
| :--- | :--- | :--- |
| 以太网 | 10Mbps ~ 1000Gbps | LAN, MAN |
| 802.11 | 5.5Mbps ~ 150Mbps | LAN |
| Bluetooth | 上限 2.1Mbps, 下限 177.1kbps | LAN |
| ATM | 25Mbps, 155Mbps, 622Mbps, 2.4Gbps | LAN ~ WAN |
| POS | 51.84Mbps ~ 40Gbps | WAN |
| FDDI | 100Mbps | LAN, WAN |
| Token Ring | 4Mbps, 16Mbps | LAN |
| 100VG-AnyLAN | 100Mbps | LAN |
| 光纤通道 | 133Mbps ~ 4Gbps | SAN |
| HIPPI | 800Mbps, 1.6Gbps | 两台计算机之间的连接 |
| IEEE1394 | 100Mbps ~ 800Mbps | 面向家庭 |

#### 公共网络
公共通信服务类似于电信运营商 (如 NTT, KDDI 或软银等) 提供的电话网络

##### 模拟电话线路
模拟电话线路其实就是利用固定电话线路进行通信, 电话线中的音频带宽用于拨号上网, 该方法不需要特殊的通信线路, 完全使用已普及的电话网, 让计算机与电话线相连需要有一个将数字信号转换为模拟信号的调制解调器 (俗称 "猫"), 传输速率一般只在 56kbps 左右, 所以已经被逐渐淘汰

##### 移动通信服务
在日本, 移动通信服务包括手机和 PHS 服务, 它们的特点是只要在服务区范围内, 就可以连接到运营商的网络

##### ADSL
ADSL 是对已有的模拟电话线路进行拓展的一种服务, ADSL 是利用话机到电信局交换机之间这段线路, 附加一个叫做分离器的装置, 将音频信号 (低频信号) 和数字信号 (高频信号) 隔离以免产生噪声干扰

##### FTTH
FTTH (Fiber To The Home) 是一根高速光纤直接连到用户家里或公司建筑物处的方法; 它通过一个叫做 OUT 的装置将计算机与之关联, 该装置负责在光信号与电子信号之间的转换, 使用 FTTH 可以实现稳定的高速通信

##### 有线电视
TODO

##### 专线
专线的连接一定是一对一的连接, 虽然 ATM 的设计初衷允许有多个目的地, 但对于提供专线服务的 ATM Mega-Link 也只能指定一个目的地, 因此不可能像 ISDN 或帧中继那样引进一条线就能连接多个目的地

##### VPN
虚拟专用网络 (VPN) 用于连接距离较远的地域, 这种服务包括 IP-VPN 和广域以太网
- IP-VPN
意在 IP 网络 (互联网) 上建立 VPN; 网络服务商提供一种在 IP 网络说那个使用 MPLS 技术构建的 VPN 服务; 其中 MPLS (Multiprotocol Label Switching, 多协议标签交换) 在 IP 包中附加一个叫做标签 (Lable) 的信息进行传输控制, 每个用户的标签信息不同, 因此在通过 MPLS 网时, 可以轻松地判断出目标地址, 这样一来就可以将多个不同用户的 VPN 信息通过 MPLS 网加以区分, 形成封闭的私有网络; 企业也可以在互联网上建立自己的 VPN, 一般采用的是 IPsec 技术, 该方法对 VPN 通信中的 IP 包进行验证和加密, 在互联网上构造一个封闭的私有网络
- 广域以太网
广域以太网是在作为数据链路层的以太网上利用 VLAN (虚拟局域网) 实现 VPN 技术, 该技术还可以使用 TCP/IP 中的其他协议

##### 公共无线 LAN
指公开的可以使用 Wi-Fi 的服务

##### 其他公共无线通信服务
- X.25
- 帧中继
- ISDN
