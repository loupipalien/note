### TCP/IP 基础知识
TCP (Transmission Control Protocol) 和 IP (Internet Protocol)

#### TCP/IP 出现的背景及其历史
TODO

#### TCP/IP 的标准化
##### TCP/IP 的具体含义
TCP/IP 确实可指 TCP 协议和 IP 协议, 但大多数情况下 TCP/IP 协议是指 TCP/IP 网际协议族, 包括应用协议 (HTTP, SMTP, FTP, TELNET, SNMP), 传输协议 (TCP, UDP), 网际协议 (IP, ICMP, ARP), 路由控制协议 (RIP, OSPF, BGP) 等

##### TCP/IP 标准的精髓
TODO
##### TCP/IP 规范 - RFC
TODO
##### TCP/IP 的标准化流程
TODO
##### RFC 的获取方法
TODO

#### 互联网基础知识
##### 互联网定义
互联网英文单词原为 "Internet", 是指将多个网络连接使其构成一个更大的网络, 所以本意文网际网; 现在互联网已经是一个专有名词了, 其对应的英文单词为 "The Internet" (Internet 指网际网, The Internet 指互联网)

##### 互联网与 TCP/IP 的关系
互联网进行通信时, 需要相应的网络协议, TCP/IP 原本就是为使用互联网而开发制定的协议族

##### 互联网的结构
互联网中的每个网络都是由骨干网 (BackBone) 和末端网 (Sub) 组成的, 每个网络之间通过网络操作中心 (NOC, Network Operation Center) 相连, 如果网络运营商 (ISP, Internet Service Provider) 不同, 它的网络连接的方式和使用方法也会不同, 连接这种异构网络需要有网络交换中心 (IX, Internet Exchange) 的支持

##### ISP 与区域网
连接互联网需要向 ISP 或区域网提出申请; 公司或家庭申请入网只需要联系 ISP 签约, 不同的 ISP 所提供的互联网接入服务的项目也不同; 区域网指的是在特定区域内由团体或志愿者所运营的网络

#### TCP/IP 协议分层模型
##### TCP/IP 与 OSI 参考模型

| OSI 参考模型 | TCP/IP 参考模型 |
| :--- | :------------- |
| 应用层 | 应用层: DNS, URI, HTTP, TLS/SSL, SMTP, POP, IMAP, MIME, TELNET, SSH, FTP, SNMP, MIB, SIP, RTP, LDAP | 应用程序 |
| 表示层 | 同上 | 同上 |
| 会话层 | 同上 | 同上 |
| 传输层 | 传输层: TCP, UDP, UDP-Lite, SCTP, DCCP | 操作系统 |
| 网络层 | 互联网层: ARP, IP, ICMP | 同上 |
| 数据链路层 | 网卡层 | 设备驱动程序与网络接口 |
| 物理层 | (硬件) | 同上 |

OSI 参考模型注重 "通信协议必要的功能是什么", 而 TCP/IP 则更强调 "在计算机上实现协议应该开发哪种程序"

##### 硬件 (物理层)
TCP/IP 的最底层是负责数据传输的硬件, 这种硬件就相当于以太网或电话线路等物理层设备; TCP/IP 是在网络互连的设备之间能够通信的前提下才被提出的协议

##### 网络接口层 (数据链路层)
网络接口层利用以太网中的数据链路层进行通信, 因此属于接口层

##### 互联网层 (网络层)
互联网层使用 IP 协议, 它相当于 OSI 模型中的第 3 层网络层, IP 协议基于 IP 地址转发分包数据; TCP/IP 分层中的互联网层与传输层的功能通常有操作系统提供, 尤其是路由器必须实现通过互联网层转发分组数据包的功能; 此外, 连接互联网的所有主机跟路由器必须实现 IP 的功能, 其他连接互联网的网络设备 (如网桥, 中继器, 集线器) 就没必要一定实现 IP 或 TCP 的功能

- IP
IP 是跨越网络传送数据包, 使整个互联网都能收到数据的协议, IP 协议是数据能够发送到地球的另一端, 这期间它使用 IP 地址作为主机的标识; 虽然 IP 也是分组交换的一种协议, 但是它不具有重发机制, 即使分组数据包未能到达目标端主机也不会重发, 因此属于非可靠性传输协议
- ICMP
IP 数据包在发送途中一旦发生异常导致无法到达目标端地址时, 需要给发送端发送一个发送异常通知; ICMP 就是为这一功能而制定的, 它有时也被用来诊断网络的健康状况
- ARP
从分组数据包的 IP 地址找那个解析出物理地址 (MAC 地址) 的一种协议

##### 传输层
传输层最主要的功能是能够让应用程序之间实现通信, TCP/IP 的传输层有两个具有代表性的协议
- TCP
TCP 是一种面向连接的传输层协议, 它可以保证两端通信主机之间的通信可达, TCP 能够正确处理在传输过程中丢包, 传输顺序乱掉等异常情况, 此外还能够有效利用带宽, 缓解网络拥堵; 然而为了建立与断开连接, 需要至少 7 次的发包接包, 导致网络流量的浪费
- UDP
UDP 有别于 TCP, 它是一种面向无连接的传输层协议, UDP 不会关注目标端是否接受到了数据, 如需检测则需要在应用程序中实现; 因此常用于分组数据较少或多播, 广播通信以及视频通信等多媒体领域中

##### 应用层 (会话层以上的分层)
TCP/IP 的分层中, 将 OSI 参考模型中的会话层, 表示层和应用层的功能都集中到了应用程序中实现; 这些功能有时由一个单一的程序实现, 有时也可能由多个程序实现
- WWW
浏览器与服务端之间通信所用的协议 HTTP (HyperText Transfer Protocol), 所传输数据的主要格式是 HTML (HyperText Markup Language), WWW 中的 HTTP 属于 OSI 应用层的协议, 而 HTML 属于表示层的协议
- 电子邮件 (EMAIL)
发送电子邮件用到协议叫做 STMP (Simple Mail Tranfer Protocol), 电子格式的格式由 MIME 协议扩展以后就可以声音, 图像等信息; MIME 属于 OSI 参考模型的表示层
- 文件传输 (FTP)
文件传输过程中使用的协议叫做 FTP (File Transfer Protocol), 在 FTP 中进行文本传输时会建立两个 TCP 连接, 分别是发出传输请求时所要用到的控制连接与实际传输数据所要用到的数据连接
- 远程登录 (TELNET 与 SSH)
TCP/IP 网络中远程登录常用 TELNET 和 SSH 两种协议; 除此之外还有 BSD UNIX 中的 rlogin 的 r 命令以及 X Window System 中的 X 协议
- 网络管理 (SNMP)
在 TCP/IP 中进行网络管理时, 采用 SNMP (Simple Network Management Protocol) 协议, 使用 SNMP 管理的主机, 网桥, 路由器称作 SNMP 代理 (Agent), 而进行管理的那一段叫做管理器 (Manager), SNMP 正是这个 Manager 和 Agent 所要使用的协议; 在 SNMP 的代理端, 保存着网络接口的信息, 通信数据量等信息, 这些信息可以通过 MIB (Manager Information Base) 访问; 在 TCP/IP 的网络管理中, SNMP 属于应用信息, MIB 属于表示层协议

#### TCP/IP 分层模型与通信示例
##### 数据包首部
```
-----------------------------------
|以太网包首部|IP包首部|TCP包首部|数据|  以太网数据包
-----------------------------------
            -----------------------
            |IP包首部|TCP包首部|数据|  IP 数据包
            -----------------------
                     --------------
                     |TCP包首部|数据|  TCP 数据包
                     --------------
```
每个分层中, 都会对所发送的数据附加一个首部, 在这个首部中包含了该层必要的信息, 例如发送的目标以及协议的相关信息; 通常为协议提供的信息为包首部, 所要发送的内容为数据; 从下一层的角度看, 从上一层收到的包全部都被认为是本层的数据

- 包, 帧, 数据报, 段, 消息
包可以说是全能性的术语, 帧用于表示数据链路层中包的单位, 而数据报是 IP 等网络层以上分层中的包单位, 段则表示 TCP 数据流中的信息, 消息是应用协议中数据的单位
- 包首部
网络中传输的数据包由两部分组成, 一部分是协议所要用到的首部, 另一部分是上层传过来的数据; 在数据包首部, 定义了协议的具体规范数据

##### 发送数据包
TCP/IP 各层对邮件的收发处理  
![TCPIP各层对邮件的收发处理.png](http://ww1.sinaimg.cn/large/d8f31fa4ly1gbcoq3vn1yj20su0iwgn4.jpg)

##### 经过数据链路的包
分组数据包经过以太网数据链路时的大致如下, 该图对各个包首部做了简化  
![分层中包的结构.png](http://ww1.sinaimg.cn/large/d8f31fa4ly1gbcrhm3i1sj20qe0413yo.jpg)  
此外每个分层的包首部还包含一个识别位, 用来标识上一层协议的种类信息; 例如以太网的包肘部中的以太网类型, IP 中的协议类型以及 TCP/UDP 中两个端口号都起着识别类型协议的作用; 在应用的首部信息中, 有时也会包含一个用来识别数据类型的标签

##### 数据包的接收处理
包的接收过程是发送流程的逆序过程
- 网络接口 (以太网驱动) 的处理
主机接收到以太网包后, 首先从以太网包首部找到 MAC 地址判断是否为发送给自己的包, 如果是就查找以太网首部中的类型域, 确定将数据传给 IP 还是 ARP 等协议处理, 如果不是则丢弃
- IP 模块的处理
与网络层是类似的处理方式; 在有路由器的情况下, 接收端地址往往不是自己的地址, 此时需要借助路由控制表, 在调查应该送达的主机或路由器以后再转发数据
- TCP 模块的处理
在 TCP 模块中, 首先会计算校验和, 判断数据是否被破坏, 然后检查是否按照序号接收数据, 最后检查端口号确定具体的应用程序
- 应用程序的处理
接收端应用程序会直接接收发送端发送的数据, 通过解析数据可以获知邮件的收件人是 B 的地址, 如果主机上没有 B 的地址, 那么主机返回给发送端一个 "无此收件地址" 的信息, 如果主机有 B 的地址, 则 B 能够收到电子邮件
