### 数据模型详解

#### 关系
聚合的有用之处在于它可以把经常访问的数据放在一起, 但是有些情况下, 需要以不同方式来访问相互关联的数据; 考虑一下客户和其全部订单之间的关系, 在这种情况下会把订单和客户放在两个聚合中, 但是想在它们之间设定某种关系, 以便能根据订单查出客户数据, 要提供这种关联最简单的办法就是把客户 ID 嵌入订单的聚合数据中  
如果两个聚合有了关系, 那么一个重要的问题是如何更新数据, 面向聚合数据库获取数据时以聚合尾为单元, 它只能保证单一聚合内部内容的原子性, 所以面向聚合数据库在操作多个聚合时显得相当笨拙  
如果待处理的数据中存在大量关系, 那么这意味着更应该选用关系型数据库而不是 NoSQL 型数据库

#### 图数据库
TODO

#### 无模式数据库
各种形式的 NoSQL 数据库有个共同点, 那就是它们没有模式; 若要在关系型数据库中存储数据, 首先必须定义 "模式", 也就是用一种预定义结构向数据库说明, 先定义好模式才能存储数据; 相比之下, NoSQL 数据库的数据存储就比较随意, 但是不管数据库 "无模式" 到何种地步, 总会存在 "隐含模式", 即编写数据操作代码时, 对数据结构所做的一系列假设  
应用程序代码中的隐含模式会带来一些问题, 这意味着要想理解数据库中存放的数据, 必须深入研究应用程序的代码才行, 若代码结构非常好, 那么可以较为轻松的推断出数据的模式, 然而这一点无法保证; 此外无模式数据库感知步到模式, 所以它无法用模式来提升存储与获取数据的效率, 它也无法自行验证数据, 以防止多个应用程序以不一致的方式操作数据; 所以从本质上来说, 无模式数据库就是把模式交由访问其数据的应用程序代码来处理

#### 物化视图
在使用面向聚合的数据模型时, 如果想访问订单数据, 那么把一份订单内的数据都放在一个聚合中比较合适, 这样它就能作为一个数据订单来存储和访问了; 但与之对应, 面向聚合也有一个缺点: 当统计某个产品几周内的销量时, 聚合反而帮了倒忙; 要做到这一点需要从数据库中读出每份订单, 才能统计出数据; 关系型数据库在这一点上就体现出了它的优势, 因为不存在聚合, 所以可以用不同的方式访问数据  
为了解决这一问题, "物化视图" (materialized view) 应用而生, 这是一种预先算好并缓存在磁盘中的视图; 虽然 NoSQL 数据库没有视图, 但是它们可以预先计算查询操作的结果, 并将其缓存起来, NoSQL 借用 "物化视图" 这个术语来表述此操作; 一般来说, 构建视图有两种办法: 第一种是一有基础数据变动, 那么立即更新物化视图; 第二种则是定期更新视图数据, 这需要理解业务需求, 据此判断物化视图可以使用多久以前的数据

#### 构建数据存取模型
TODO
#### 要点
- 使用面向聚合的数据库处理不同聚合之间的关系, 要比处理同一聚合内部的关系更难
- 图数据库将数据组织成一张由节点和边所组成的图, 适合处理关系复杂的数据结构
- 在无模式数据库中, 可以给记录随意新增字段, 然而用户在使用数据时, 通常还是要遵守一套隐式模式
- 面向聚合的数据库通常能够用不同的方式重组主聚合 (primary aggregate) 的数据, 以计算出各种 "物化视图"; 计算过程一般通过 "映射化简" 来实现 
