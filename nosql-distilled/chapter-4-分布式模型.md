### 分布式模型
催生 NoSQL 的主要原因是需要一种能够运行在大集群上的数据库, 随着数据越来越多, 纵向扩展的成本越来越高且有限制; 与纵向扩展相比横向扩展成本更低且无限制, 面向聚合数据库非常适用于横向扩展方式, 因为聚合时就自然成了数据分布单元  
一般来说, 数据分布有两种方法: 复制 (replication) 和分片 (sharding); 复制就是将同一份数据拷贝到多个节点, 而分片则是将不同数据存放在不同节点中, 复制和分片是相互正交的: 既可以在两者中任选起义, 也可以同时使用它们; 复制有两种形式: 主从式 (master-slave) 和 对等式 (peer-to-peer)

#### 单一服务器
最简单的分布形式就是不分布, 将数据放置在一台机器上; 这样的方式使用时可以不用考虑其他方案所需解决的复杂事务

#### 分片
一般来说, 数据库的繁忙体现在: 不同用户需要访问数据集中的不同部分, 在这种情况下, 把数据的各个部分存放于不同的节点上, 以此实现横向扩展; 该技术叫做分片 (sharding)   
分片对性能提升尤为有用, 因为各个节点各自负责自己的读取和写入, 因此可以提高集群的读取和写入效率; 如果单就分片技术来说, 它对改善数据库的 "故障恢复能力" 帮助并不大, 尽管数据分布在不同的节点上, 但是和单一服务器方案一样, 只要某个节点出错, 那么该分片上的数据就无法访问了; 它提供的弹性仅仅在于: 只有访问此数据的那些客户端才会受影响, 而其余客户端可以正常使用

#### 主从复制
在主从式分布 (master-slave distribution) 中, 要把数据复制到多个节点上; 其中一个叫做主节点 (master), 主节点存放权威数据, 通常负责处理数据更新操作; 其余节点都叫从节点, 复制操作就要让从节点与主节点同步  
在需要频繁读取数据的情况下, 主从复制最有助于提升数据访问性能, 以新增更多从节点的方式进行水平扩展, 就可以同时处理更多数据读取请求, 并且能保证将所有请求都引导至从节点; 然而数据库仍受制于主节点处理更新, 以及向从节点发布更新的能力; 所以在写入操作特别频繁的场合, 虽然将读取操作分流可以缓解写入操作的处理压力, 但这样安排数据集的效果并不好  
主从复制的第二个好处是, 可以增强读取操作故障恢复能力: 当主节点宕机时可以在从节点处理读取请求, 但此优势也只在读取操作占比较多时有效; 当主节点宕机后, 除非将其恢复或另行指派新的主节点, 否则数据库就无法处理写入操作; 如果能够指派从节点代替宕机的主节点, 这意味着就算不需要横向扩展, 主从复制也有其用处  
为了使读取操作具备故障恢复能力, 必须确保应用程序分别沿着不同的路径发出读取与写入请求, 这样才能在处理写入路径故障时保证读取操作不受影响  
主从复制带来了以上好处之外, 也有一个不可避免的缺陷, 那就是数据不一致性; 如果数据更新还没全部复制到从节点, 那么不同的客户端就可能从不同的从节点读取不同的值, 或者无法读出最新的值

#### 对等复制
主从复制有助于增强读取操作的故障恢复能力, 然而对写入操作却帮助不; 它所提供的故障恢复能力, 只有在从节点出错时才能体现出来, 而不针对主节点; 所以主节点仍然是系统的瓶颈与弱点, 对等复制 (peer-to-peer) 则能解决这一问题, 它没有主节点这一概念, 所有的副本节点地位相同, 都可以接受写入请求, 而且丢失一个副本并不影响数据库的访问  
但对等复制也有它自己的麻烦, 即数据一致性; 由于不同节点可以同时处理写入操作, 所以有可能出现多个客户端在同一时间试图更新同一条记录的情况, 这就导致了写入冲突 (write-write conflict); 数据读取的不一致性也是个问题, 不过至少持续时间较短, 而写入操作导致的不一致数据总是存在, 解决这一问题的大致思路有以下几种
- 不管何时写入数据, 各副本之间总能相互协调确保不发生冲突
- 设法处理这些不一致的写入操作

#### 结合分片与复制技术
复制与分片两种策略可以结合起来使用, 使整个集群有多个主节点, 然而对于每项数据来说, 负责它的主节点只有一个; 根据配置需要, 同一个节点既可以做某些数据的主节点, 也可以充当其他数据的从节点  
在使用列族数据库时, 经常会采用对等复制和分片结合; 在这种情况下, 数据可能分布于集群中的数十个或数百个节点上; 在采用对等复制是, 一旦某个节点出错, 那么它上面保存的那些分片数据会由其他节点重建
